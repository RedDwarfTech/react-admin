"use strict";(self.webpackChunkreact_admin=self.webpackChunkreact_admin||[]).push([[535],{98737:function(e,t,n){n.d(t,{AU:function(){return d}});var r=n(24559),a=n.n(r),o=n(52018),s=n(78464),c=n(22078),u=!1,i=[],l=a().create({timeout:15e3});function f(){o.Z.dispatch((0,c.xW)("")),window.location.href="/#/login"}function d(e,t){return l(e).then((function(e){if(e){var n=null==e.data.result||0===Object.keys(e.data.result).length?{}:e.data.result;o.Z.dispatch(t(n))}})).catch((function(e){console.error(e)}))}l.defaults.headers.post["Content-Type"]="application/json",l.interceptors.request.use((function(e){var t=localStorage.getItem("accessToken");return t&&(e.headers["x-access-token"]=t),e}),(function(e){return Promise.reject(e)})),l.interceptors.response.use((function(e){if(200===e.status&&"200"===e.data.statusCode&&"200"===e.data.resultCode)return Promise.resolve(e);if("907"===e.data.statusCode)f();else if("904"===e.data.statusCode)f();else{if("00100100004016"!==e.data.resultCode){var t=e.data.msg;return s.ZP.error(t),Promise.reject(e)}!function(e){var t,n=e.config;if(u)return new Promise((function(e){i.push((function(t){n.baseURL="",n.headers["x-access-token"]=t,e(l(n))}))}));u=!0,(t=localStorage.getItem("refreshToken"),t||f(),function(e){return function(e){return l(e).then((function(e){if(e)return null==e.data.result||0===Object.keys(e.data.result).length?{}:e.data.result})).catch((function(e){console.error(e)}))}({method:"post",url:"/manage/auth/access_token/refresh",data:{deviceId:"xxxxxx",app:6,refreshToken:e}})}(t)).then((function(e){var t=e.accessToken;if(t)return localStorage.setItem("token",t),localStorage.setItem("accessToken",t),l.defaults.headers["x-access-token"]=t,i.forEach((function(e){return e(t)})),i=[],l(n)})).catch((function(e){console.error("refreshtoken error =>",e),f()})).finally((function(){u=!1}))}(e)}}),(function(e){switch(e.response.status){case 401:case 403:case 404:case 500:break;default:console.log("其他错误信息")}return Promise.reject(e)}))},40548:function(e,t,n){n.d(t,{WO:function(){return o},lE:function(){return s},Io:function(){return c}});var r=n(22078),a=n(98737);function o(e){var t={method:"post",url:"/manage/admin/user/login",data:e};return(0,a.AU)(t,r.x4)}function s(e){var t={method:"post",url:"/manage/user/v1/page",data:e};return(0,a.AU)(t,r.nQ)}function c(e){var t={method:"post",url:"/manage/user/v1/pwd/edit",data:e};return(0,a.AU)(t,r.Af)}},25249:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r=n(27004),a=n(16306),o=n(38439),s=n(71553),c=n(1549),u=n(26933),i=n(51110),l=n(97692),f=n(84264),d=n.n(f),m=n(35466),h=n(78464),p=n(60422),g=n(95937),k=n(18247),Z=n(43039),v=n(33116),y=n(70445),x=n(48230),E=n(86918),I=n(19249),w=n(40548);var S=n(34690).ZP.load(),T=function(e){(0,c.Z)(x,e);var t,n,f=(t=x,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,i.Z)(t);if(n){var a=(0,i.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,u.Z)(this,e)});function x(){var e;(0,a.Z)(this,x);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=f.call.apply(f,[this].concat(n)),(0,l.Z)((0,s.Z)(e),"state",{loading:!1}),(0,l.Z)((0,s.Z)(e),"enterLoading",(function(){e.setState({loading:!0})})),(0,l.Z)((0,s.Z)(e),"handleLoginSuccess",(function(t){if(t.token&&t.token.token){t.username,t.auth=0;var n=t.token.accessToken;localStorage.setItem("token",n),localStorage.setItem("refreshToken",t.token.refreshToken),localStorage.setItem("accessToken",t.token.accessToken),localStorage.setItem("user",JSON.stringify(t)),e.enterLoading(),h.ZP.success("登录成功!"),e.props.history.push("/")}})),(0,l.Z)((0,s.Z)(e),"handleLoginSubmit",(function(e){(0,r.Z)(d().mark((function t(){var n,r,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S;case 2:return n=t.sent,t.next=5,n.get();case 5:r=t.sent,a={phone:e.username,password:e.password,deviceId:r.visitorId,app:6},(0,w.WO)(a);case 8:case"end":return t.stop()}}),t)})))()})),(0,l.Z)((0,s.Z)(e),"formRef",m.createRef()),e}return(0,o.Z)(x,[{key:"componentWillUnmount",value:function(){p.Z.destroy(),this.timer&&clearTimeout(this.timer)}},{key:"render",value:function(){var e=this.props.user;return this.handleLoginSuccess(e),m.createElement(g.Z,{className:"login animated fadeIn"},m.createElement("div",{className:"model"},m.createElement("div",{className:"login-form"},m.createElement("h3",null,"后台管理系统"),m.createElement(k.Z,null),m.createElement(Z.Z,{onFinish:this.handleLoginSubmit,ref:this.formRef},m.createElement(Z.Z.Item,{name:"username",rules:[{required:!0,message:"请输入用户名!"}]},m.createElement(v.Z,{prefix:m.createElement(E.Z,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"用户名"})),m.createElement(Z.Z.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}]},m.createElement(v.Z,{prefix:m.createElement(I.Z,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"密码"})),m.createElement(Z.Z.Item,null,m.createElement(y.Z,{type:"primary",htmlType:"submit",className:"login-form-button",loading:this.state.loading},"登录"))))))}}]),x}(m.Component),b=(0,x.EN)(T)}}]);